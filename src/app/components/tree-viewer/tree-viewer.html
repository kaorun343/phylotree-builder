<div class="tree-viewer">
  <svg [attr.width]="svgWidth()" [attr.height]="svgHeight()" class="tree-svg">
    <!-- Draw branches -->
    <g class="branches" [attr.transform]="marginTransform()">
      @for (branch of visibleBranches(); track branch.id) {
      <path
        [attr.d]="branch | branchPath"
        class="branch"
        [class.branch-hover]="isEdgeHovered()(branch.child.id)"
        [attr.stroke-width]="isEdgeHovered()(branch.child.id) ? 4 : 2"
        fill="none"
        (click)="onEdgeClick(branch.child)"
        (mouseenter)="onEdgeHover(branch.child)"
        (mouseleave)="onEdgeLeave()"
      ></path>
      }
    </g>

    <!-- Draw nodes -->
    <g class="nodes" [attr.transform]="marginTransform()">
      @for (node of visualNodes(); track node.id) {
      <!-- Selection indicator (behind node) -->
      @if (isNodeSelected()(node.id)) {
      <circle
        [attr.cx]="node.position.x"
        [attr.cy]="node.position.y"
        [attr.r]="getNodeRadius()(node) + 3"
        class="selection-ring"
      ></circle>
      }

      <!-- Node circle -->
      <circle
        [attr.cx]="node.position.x"
        [attr.cy]="node.position.y"
        [attr.r]="getNodeRadius()(node)"
        [attr.class]="getNodeClasses()(node)"
        (click)="onNodeClick(node)"
        (mouseenter)="onNodeHover(node)"
        (mouseleave)="onNodeLeave()"
      ></circle>

      <!-- Node label -->
      <text
        [attr.x]="node.position.x + 10"
        [attr.y]="node.position.y + 5"
        class="node-label"
        [class.selected-label]="isNodeSelected()(node.id)"
      >
        {{ node.name }}
        @if (node.branchLength) {
        <tspan class="branch-length">:{{ node.branchLength }}</tspan>
        }
      </text>
      }
    </g>
  </svg>
</div>
