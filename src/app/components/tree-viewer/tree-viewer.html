<div class="tree-viewer">
  <svg [attr.width]="svgWidth()" [attr.height]="svgHeight()" class="tree-svg">
    <!-- Draw branches -->
    <g class="branches" *ngIf="tree()">
      <ng-container *ngFor="let node of visualNodes()">
        <g *ngFor="let childId of node.children">
          <ng-container *ngIf="getNodeById()(childId) as child">
            <line
              [attr.x1]="node.position.x"
              [attr.y1]="node.position.y"
              [attr.x2]="child.position.x"
              [attr.y2]="child.position.y"
              class="branch"
              [attr.stroke-width]="2"
            ></line>
          </ng-container>
        </g>
      </ng-container>
    </g>

    <!-- Draw nodes -->
    <g class="nodes" *ngIf="tree()">
      <ng-container *ngFor="let node of visualNodes()">
        <!-- Selection indicator (behind node) -->
        <circle
          *ngIf="isNodeSelected()(node.id)"
          [attr.cx]="node.position.x"
          [attr.cy]="node.position.y"
          [attr.r]="getNodeRadius()(node) + 3"
          class="selection-ring">
        </circle>
        
        <!-- Node circle -->
        <circle
          [attr.cx]="node.position.x"
          [attr.cy]="node.position.y"
          [attr.r]="getNodeRadius()(node)"
          [attr.class]="getNodeClasses()(node)"
          (click)="onNodeClick(node)"
          (mouseenter)="onNodeHover(node)"
          (mouseleave)="onNodeLeave(node)">
        </circle>

        <!-- Node label -->
        <text
          [attr.x]="node.position.x + 10"
          [attr.y]="node.position.y + 5"
          class="node-label"
          [class.selected-label]="isNodeSelected()(node.id)">
          {{ node.name }}
          <tspan *ngIf="node.branchLength" class="branch-length">
            :{{ node.branchLength }}
          </tspan>
        </text>
      </ng-container>
    </g>
  </svg>
</div>
